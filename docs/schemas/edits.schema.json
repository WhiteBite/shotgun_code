{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Shotgun.Edits",
  "type": "object",
  "required": [
    "edits"
  ],
  "properties": {
    "schemaVersion": {
      "type": "string",
      "description": "Версия схемы Edits JSON"
    },
    "toolchainVersion": {
      "type": "string",
      "description": "Версия инструментария"
    },
    "metadata": {
      "type": "object",
      "properties": {
        "reason": {
          "type": "string",
          "description": "Причина изменений"
        },
        "taskId": {
          "type": "string",
          "description": "ID задачи из tasks/plan.yaml"
        },
        "stepId": {
          "type": "string", 
          "description": "ID шага из tasks/steps/*.yaml"
        },
        "confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Уверенность в изменениях (0-1)"
        },
        "estimatedImpact": {
          "type": "string",
          "enum": ["low", "medium", "high", "critical"],
          "description": "Оценка влияния изменений"
        }
      }
    },
    "edits": {
      "type": "array",
      "items": {
        "type": "object",
        "required": [
          "path",
          "language"
        ],
        "properties": {
          "id": {
            "type": "string",
            "description": "Уникальный идентификатор правки"
          },
          "atomicGroup": {
            "type": "string",
            "description": "Группа атомарных изменений"
          },
          "dependsOn": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Зависимости от других правок"
          },
          "kind": {
            "type": "string",
            "enum": [
              "recipeOp",
              "workspaceEdit",
              "astOp",
              "anchorPatch",
              "fullFile"
            ],
            "description": "Тип операции"
          },
          "op": {
            "type": "string",
            "enum": [
              "modify",
              "create",
              "delete",
              "move"
            ],
            "description": "Операция"
          },
          "path": {
            "type": "string",
            "pattern": "^(?!\\.\\./)(?!/).+",
            "description": "Относительный путь к файлу"
          },
          "language": {
            "type": "string",
            "enum": [
              "go",
              "ts",
              "js",
              "vue",
              "java",
              "kotlin",
              "py",
              "rs",
              "dart",
              "yaml",
              "hcl",
              "json",
              "md",
              "txt"
            ],
            "description": "Язык программирования"
          },
          "strategy": {
            "type": "string",
            "enum": [
              "ast",
              "symbol",
              "anchor",
              "fullFile"
            ],
            "description": "Стратегия применения изменений"
          },
          "engine": {
            "type": "string",
            "enum": [
              "openrewrite",
              "ts-morph",
              "go-ast",
              "libcst",
              "jscodeshift",
              "recast"
            ],
            "description": "Движок для AST операций"
          },
          "recipe": {
            "type": "object",
            "description": "Параметры рецепта для recipeOp"
          },
          "payload": {
            "type": [
              "object",
              "null"
            ],
            "properties": {
              "text": {
                "type": "string",
                "description": "Новый текст"
              },
              "astOp": {
                "type": "object",
                "description": "AST операция"
              }
            }
          },
          "workspaceEdit": {
            "type": [
              "object",
              "null"
            ],
            "properties": {
              "textEdits": {
                "type": "array",
                "items": {
                  "type": "object",
                  "required": [
                    "range",
                    "newText"
                  ],
                  "properties": {
                    "range": {
                      "type": "object",
                      "required": [
                        "start",
                        "end"
                      ],
                      "properties": {
                        "start": {
                          "type": "object",
                          "properties": {
                            "line": {
                              "type": "integer"
                            },
                            "ch": {
                              "type": "integer"
                            }
                          }
                        },
                        "end": {
                          "type": "object",
                          "properties": {
                            "line": {
                              "type": "integer"
                            },
                            "ch": {
                              "type": "integer"
                            }
                          }
                        }
                      }
                    },
                    "newText": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "anchor": {
            "type": [
              "object",
              "null"
            ],
            "properties": {
              "before": {
                "type": "string",
                "description": "Текст перед изменением"
              },
              "after": {
                "type": "string",
                "description": "Текст после изменения"
              },
              "position": {
                "type": "string",
                "enum": [
                  "before",
                  "after",
                  "replace"
                ],
                "description": "Позиция вставки"
              },
              "hash": {
                "type": "string",
                "description": "Хеш окна для верификации"
              },
              "contextLines": {
                "type": "integer",
                "minimum": 0,
                "description": "Количество строк контекста"
              }
            }
          },
          "constraints": {
            "type": [
              "object",
              "null"
            ],
            "properties": {
              "maxChangedLines": {
                "type": "integer",
                "minimum": 0,
                "description": "Максимальное количество измененных строк"
              },
              "forbidPaths": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Запрещенные пути"
              },
              "maxFiles": {
                "type": "integer",
                "minimum": 1,
                "description": "Максимальное количество файлов"
              },
              "requireTests": {
                "type": "boolean",
                "description": "Требовать наличие тестов"
              },
              "requireDocumentation": {
                "type": "boolean",
                "description": "Требовать документацию"
              }
            }
          },
          "post": {
            "type": [
              "object",
              "null"
            ],
            "properties": {
              "formatters": {
                "type": "array",
                "items": {
                  "type": "string",
                  "enum": [
                    "gofmt",
                    "goimports", 
                    "prettier",
                    "eslint",
                    "black",
                    "ruff",
                    "clang-format"
                  ]
                },
                "description": "Форматеры для применения"
              },
              "testsToRun": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Тесты для запуска"
              },
              "staticAnalyzers": {
                "type": "array",
                "items": {
                  "type": "string",
                  "enum": [
                    "staticcheck",
                    "go-vet",
                    "eslint",
                    "mypy",
                    "pylint"
                  ]
                },
                "description": "Статические анализаторы"
              },
              "metadata": {
                "type": "object",
                "description": "Дополнительные метаданные"
              }
            }
          }
        }
      }
    }
  }
}